<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>üé≤ ‡πÄ‡∏Å‡∏°‡∏ô‡πâ‡∏≥‡πÄ‡∏ï‡πâ‡∏≤‡∏õ‡∏π‡∏õ‡∏•‡∏≤ (Firebase Edition)</title>

<style>
  /* ******************************************************** */
  /* >>>>>> ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡πá‡∏≠‡∏Ñ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ (‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô) <<<<<<< */
  /* ******************************************************** */
  html, body {
    /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Body ‡πÅ‡∏•‡∏∞ HTML ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î */
    width: 100vw;
    height: 100vh;
    /* ‡∏´‡πâ‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô (Scroll) ‡∏ó‡∏±‡πâ‡∏á‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
    overflow: hidden; 
    /* ‡∏õ‡∏£‡∏±‡∏ö padding/margin ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà 0 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡∏°‡∏≤ */
    margin: 0;
    padding: 0;
  }
  /* ******************************************************** */
  
  /* CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏•‡∏∞ Fonts */
  @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@400;700&display=swap');
  body {
    font-family: 'Prompt', sans-serif;
    text-align: center;
    background: linear-gradient(135deg, #a71d31, #3f0d12);
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite;
    color: #fff;
    padding: 20px;
  }
  @keyframes gradientBG {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  h1 {
    color: gold;
    text-shadow: 0 0 15px rgba(255, 215, 0, 0.8), 0 0 5px rgba(255, 215, 0, 0.5);
    margin-bottom: 20px;
  }
  
  /* CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô Login/Sign-Up */
  .auth-container {
    background: rgba(0, 0, 0, 0.5);
    padding: 30px;
    border-radius: 15px;
    max-width: 400px;
    margin: 50px auto;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
  }
  .auth-container input {
    width: 90%;
    padding: 12px;
    margin: 10px 0;
    border-radius: 8px;
    border: none;
    font-size: 16px;
    box-sizing: border-box;
    background-color: #f9f9f9;
    color: #333;
    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.2);
  }
  .auth-container button {
    display: block;
    width: 90%;
    margin: 15px auto 5px auto;
    padding: 15px 20px;
    border: none;
    border-radius: 12px;
    font-size: 18px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.2s ease-out;
    box-shadow: 
      0 10px 20px rgba(0, 0, 0, 0.5), 
      0 5px 10px rgba(0, 0, 0, 0.3),
      inset 0 -5px 10px rgba(0, 0, 0, 0.3);
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
    letter-spacing: 0.5px;
    text-align: center;
    text-decoration: none; 
  }
  #auth-button {
      background: linear-gradient(145deg, #FFDC00, #FF851B);
      color: black;
  }
  .toggle-link {
    color: #ffd700;
    cursor: pointer;
    text-decoration: none;
    margin-top: 15px;
    display: block;
    font-size: 14px;
    transition: 0.1s;
  }
  
  /* CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Admin Panel */
  #admin-screen {
      display: none;
      max-width: 800px;
      margin: 20px auto;
      background: rgba(0, 0, 0, 0.6);
      padding: 20px;
      border-radius: 15px;
      /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Admin screen ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏°‡∏µ‡πÄ‡∏¢‡∏≠‡∏∞ */
      max-height: calc(100vh - 40px);
      overflow-y: auto;
  }
  #admin-screen h2 {
      color: #33ff33;
      text-shadow: 0 0 8px rgba(51, 255, 51, 0.5);
  }
  /* ‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÉ‡∏´‡∏°‡πà */
  .refresh-btn-admin {
      background-color: #007bff; /* Blue for refresh */
      color: white;
      padding: 10px 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: 0.2s;
      margin-bottom: 15px;
      width: 100%;
      max-width: 300px;
  }
  .refresh-btn-admin:hover {
      background-color: #0056b3;
  }

  #user-list {
      list-style: none;
      padding: 0;
      text-align: left;
      margin-top: 20px;
  }
  #user-list li {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 10px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
  }
  /* ‡πÄ‡∏ô‡πâ‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πà‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô */
  .user-info strong {
      color: #FFDC00; 
      font-size: 1.1em;
      text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
  }
  .user-info {
      font-weight: bold;
      color: #fff;
      min-width: 150px;
  }
  .user-balance {
      color: #FFDC00;
      margin-right: 20px;
  }
  .admin-controls {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-top: 10px;
  }
  .admin-controls input[type="number"] {
      padding: 8px;
      width: 80px;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      color: #333;
  }
  .admin-controls button {
      padding: 8px 12px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: 0.1s;
  }
  .deposit-btn-admin { background-color: #33ff33; color: black; }
  .withdraw-btn-admin { background-color: #ff4136; color: white; }
  .logout-btn-admin { background-color: #ccc; color: black; margin-top: 20px; width: 100%; max-width: 200px; display: block; margin-left: auto; margin-right: auto; }

  /* CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Å‡∏° */
  #game-screen { 
    display: none; 
    /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Game Screen ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏°‡∏µ‡πÄ‡∏¢‡∏≠‡∏∞ ‡πÅ‡∏ï‡πà Body ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô */
    max-height: 100vh;
    overflow-y: auto;
    padding-top: 20px; 
    padding-bottom: 20px;
  }
  #balance {
    background: rgba(255,255,255,0.2);
    display: inline-block;
    padding: 10px 20px;
    border-radius: 25px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    font-size: 18px;
    margin-bottom: 30px;
    font-weight: bold;
    color: #f0f0f0;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  #balance button {
    margin-left: 10px; 
    padding: 5px 10px; 
    border: none; 
    border-radius: 5px; 
    cursor: pointer; 
    font-weight: bold; 
    transition: 0.1s;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
  }
  .logout-btn { background: #c30000; color: white; }
  
  /* CSS ‡πÉ‡∏´‡∏°‡πà: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô/‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô) */
  .service-buttons {
      margin-bottom: 20px;
      margin-top: -10px; 
  }
  .service-btn {
      display: inline-block;
      padding: 12px 25px;
      border-radius: 30px;
      font-size: 18px;
      font-weight: bold;
      text-decoration: none;
      color: white;
      cursor: pointer;
      transition: all 0.2s ease-out;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
      border: 2px solid white;
  }
  .service-line-btn {
      background: linear-gradient(145deg, #00C300, #3CFF3C); 
      color: black;
      border-color: #3CFF3C;
  }
  .service-btn:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.6);
  }
  
  /* Layout ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î */
  .betting-area {
      max-width: 500px;
      margin: 0 auto 25px auto;
  }
  /* ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß (Single Bets) */
  .single-bets {
    display: grid; 
    grid-template-columns: repeat(3, 1fr); 
    gap: 15px;
    margin-bottom: 30px;
  }
  .bet-btn-base {
    width: 100%; 
    padding-top: 100%; 
    position: relative;
    font-size: 45px;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.2s ease-out;
    color: white;
    font-weight: bold;
    box-shadow: 
      0 12px 25px rgba(0,0,0,0.5), 
      0 6px 12px rgba(0,0,0,0.3),  
      inset 0 -6px 15px rgba(0,0,0,0.4);
    display: flex;
    justify-content: center;
    align-items: center;
    border: none;
    line-height: 0; 
  }
  .bet-btn-base > span {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      line-height: 1;
  }
  .bet-btn-base:hover {
    transform: translateY(-4px) scale(1.03);
  }
  .bet-btn-base.selected {
    transform: translateY(-2px) scale(1.08); 
    box-shadow: 
      0 0 30px #FFD700, 
      0 15px 30px rgba(0,0,0,0.8), 
      inset 0 -6px 15px rgba(255, 215, 0, 0.7); 
    outline: 4px solid gold; 
    outline-offset: -4px;
  }
  /* ‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß */
  .bet-btn-single:nth-child(1){background: linear-gradient(145deg,#0074D9,#7FDBFF);} /* ‡∏ô‡πâ‡∏≥‡πÄ‡∏ï‡πâ‡∏≤ */
  .bet-btn-single:nth-child(2){background: linear-gradient(145deg,#FF4136,#FF851B);} /* ‡∏õ‡∏π */
  .bet-btn-single:nth-child(3){background: linear-gradient(145deg,#2ECC40,#01FF70);} /* ‡∏õ‡∏•‡∏≤ */
  .bet-btn-single:nth-child(4){background: linear-gradient(145deg,#B10DC9,#F012BE);} /* ‡πÄ‡∏™‡∏∑‡∏≠ */
  .bet-btn-single:nth-child(5){background: linear-gradient(145deg,#FFDC00,#FF851B);} /* ‡πÑ‡∏Å‡πà */
  .bet-btn-single:nth-child(6){background: linear-gradient(145deg,#39CCCC,#7FDBFF);} /* ‡∏Å‡∏∏‡πâ‡∏á */
  
  /* ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏£‡∏ß‡∏° (High/Low/Triple) */
  .compound-bets {
      /* ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Flexbox ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô */
      display: flex;
      justify-content: space-between;
      gap: 15px;
      margin-top: 30px;
  }
  .bet-btn-compound {
      flex: 1;
      padding: 15px 10px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: bold;
      color: white;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
      min-height: 60px;
      box-shadow: 
        0 8px 15px rgba(0,0,0,0.4), 
        inset 0 -4px 8px rgba(0,0,0,0.3);
      border: none;
      cursor: pointer;
      transition: all 0.2s;
  }
  .bet-btn-compound.selected {
      transform: translateY(-2px) scale(1.05); 
      outline: 4px solid #fff; 
      outline-offset: -4px;
  }
  .bet-high { background: linear-gradient(145deg, #FF69B4, #FFB6C1); } /* High */
  .bet-low { background: linear-gradient(145deg, #1E90FF, #87CEFA); } /* Low */
  .bet-triple-any { background: linear-gradient(145deg, #8B0000, #FF0000); } /* Triple (Any) */

  .bet-control { margin-bottom: 25px; display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 10px; }
  .bet-control label { font-size: 16px; font-weight: bold; }
  #betAmount { width: 120px; padding: 10px; border-radius: 10px; border: 3px solid gold; text-align: center; font-size: 18px; color: black; background-color: #f9f9f9; box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.2); }
  .bet-btn { padding: 10px 15px; border: none; border-radius: 10px; background: #FFDC00; color: black; cursor: pointer; transition: all 0.1s ease; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
  
  button#roll {
    background: gold;
    color: black;
    padding: 18px 40px;
    border: none;
    border-radius: 20px;
    font-size: 22px;
    cursor: pointer;
    transition: all 0.2s ease-out;
    box-shadow: 
      0 15px 30px rgba(255,215,0,0.6), 
      0 8px 15px rgba(255,215,0,0.4),   
      inset 0 -8px 20px rgba(0,0,0,0.3);
    position: relative;
    font-weight: bold;
    letter-spacing: 1px;
    text-transform: uppercase;
  }
  button#roll:disabled {
      background: #ccc;
      box-shadow: none;
      transform: none;
      cursor: not-allowed;
  }
  .dice { font-size: 60px; margin: 20px 0; text-shadow: 0 0 10px rgba(255,255,255,0.5); }
  .result { margin-top: 15px; font-size: 24px; color: #33ff33; text-shadow: 0 0 15px #33ff33, 0 0 5px #33ff33; font-weight: bold; }
  
  /* Responsive Design */
  @media (max-width: 600px) {
    body { padding: 10px; }
    .single-bets { max-width: none; }
    .bet-btn-base { font-size: 35px; border-radius: 20px; }
    .bet-control { flex-direction: column; gap: 8px; }
    #betAmount { width: 100%; max-width: 150px; }
    #user-list li { flex-direction: column; align-items: flex-start; }
    .admin-controls { width: 100%; justify-content: space-between; }
    .admin-controls input[type="number"] { width: 40%; }
    .admin-controls button { flex: 1; }
    
    /* ********************************************************* */
    /* >>>>>> ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡∏°‡πà: ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏ß‡∏° <<<<<<< */
    /* ********************************************************* */
    h1 { margin-top: 5px; margin-bottom: 10px; font-size: 20px; } 
    #balance { margin-bottom: 15px; padding: 8px 15px; } 
    
    /* 1. ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô/‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô) - ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î */
    .service-buttons { margin-bottom: 10px; margin-top: -5px; } 
    .service-btn {
        padding: 8px 15px; 
        font-size: 16px;
    }

    /* 2. ‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏ß‡∏° (‡∏™‡∏π‡∏á/‡∏ï‡πà‡∏≥/‡∏ï‡∏≠‡∏á) - ‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î */
    .compound-bets {
        display: grid; 
        grid-template-columns: repeat(3, 1fr); /* 3 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô */
        gap: 8px; /* ‡∏•‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á */
        margin-top: 15px; 
    }
    .bet-btn-compound {
        padding: 8px 5px; /* ‡∏•‡∏î Padding ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πá‡∏Å */
        font-size: 14px; /* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î Font */
        min-height: 50px; 
    }

    /* 3. ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏°‡∏∏‡∏ô‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤ - ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î */
    button#roll {
        padding: 12px 30px; 
        font-size: 18px;
    }

    /* ‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î */
    .dice { font-size: 50px; margin: 10px 0; } 
    .result { margin-top: 10px; font-size: 20px; }
    .betting-area { margin-bottom: 15px; } 
  }
</style>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>
<body>
  
  <div id="auth-screen">
    <h1>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö / ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å üéØ</h1>
    <div class="auth-container">
      <h2 id="auth-title">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
      <input type="text" id="username" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Username)" required>
      <input type="password" id="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (Password)" required>
      
      <div id="signup-fields" style="display:none;">
          <input type="password" id="confirmPassword" placeholder="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required>
      </div>

      <button id="auth-button" onclick="handleAuth()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
      <p id="error-message" style="color: red; margin-top: 10px; font-size: 14px;"></p>
      
      <a class="toggle-link" onclick="toggleAuthMode()">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</a>
    </div>
  </div>
  
  <div id="admin-screen">
      <h2>üõ†Ô∏è ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h2>
      <p style="color: orange;">**‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:** ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á</p>
      
      <button onclick="renderUserList()" class="refresh-btn-admin">
          üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
      </button>

      <ul id="user-list">
          </ul>
      
      <button onclick="adminLogout()" class="logout-btn-admin">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</button>
  </div>
  
  <div id="game-screen">
    <h1>üé≤ ‡πÄ‡∏Å‡∏°‡∏ô‡πâ‡∏≥‡πÄ‡∏ï‡πâ‡∏≤‡∏õ‡∏π‡∏õ‡∏•‡∏≤ üé≤</h1>
    
    <div class="service-buttons">
        <a href="https://lin.ee/Mm1caQx" target="_blank" class="service-btn service-line-btn">
            üí∏ ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô/‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô
        </a>
    </div>
    
    <div id="balance">
        üí∞ <span id="usernameDisplay">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô:</span> <span id="playerBalance">0</span> ‡∏ö‡∏≤‡∏ó
        <button onclick="logout()" class="logout-btn">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>

    <div class="betting-area">
        <p>‡πÅ‡∏ó‡∏á‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß (‡∏à‡πà‡∏≤‡∏¢ 1-3 ‡πÄ‡∏ó‡πà‡∏≤):</p>
        <div class="single-bets">
            <button class="bet-btn-base bet-btn-single" data-bet-type="single" data-bet-value="‡∏ô‡πâ‡∏≥‡πÄ‡∏ï‡πâ‡∏≤"><span>üçê</span></button>
            <button class="bet-btn-base bet-btn-single" data-bet-type="single" data-bet-value="‡∏õ‡∏π"><span>ü¶Ä</span></button>
            <button class="bet-btn-base bet-btn-single" data-bet-type="single" data-bet-value="‡∏õ‡∏•‡∏≤"><span>üêü</span></button>
            <button class="bet-btn-base bet-btn-single" data-bet-type="single" data-bet-value="‡πÄ‡∏™‡∏∑‡∏≠"><span>üêØ</span></button>
            <button class="bet-btn-base bet-btn-single" data-bet-type="single" data-bet-value="‡πÑ‡∏Å‡πà"><span>üêî</span></button>
            <button class="bet-btn-base bet-btn-single" data-bet-type="single" data-bet-value="‡∏Å‡∏∏‡πâ‡∏á"><span>ü¶ê</span></button>
        </div>

        <p>‡πÅ‡∏ó‡∏á‡∏£‡∏ß‡∏° (‡∏™‡∏π‡∏á/‡∏ï‡πà‡∏≥, ‡∏ï‡∏≠‡∏á):</p>
        <div class="compound-bets">
            <button class="bet-btn-compound bet-high" data-bet-type="high_low" data-bet-value="High">
                ‡∏™‡∏π‡∏á (11-17)<br>‡∏à‡πà‡∏≤‡∏¢ 1:1
            </button>
            <button class="bet-btn-compound bet-low" data-bet-type="high_low" data-bet-value="Low">
                ‡∏ï‡πà‡∏≥ (4-10)<br>‡∏à‡πà‡∏≤‡∏¢ 1:1
            </button>
            <button class="bet-btn-compound bet-triple-any" data-bet-type="triple_any" data-bet-value="Any">
                ‡∏ï‡∏≠‡∏á (‡∏≠‡∏≠‡∏Å 3 ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô)<br>‡∏à‡πà‡∏≤‡∏¢ 7:1
            </button>
        </div>
    </div>

    <div class="bet-control">
      <label for="betAmount">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô (‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å):</label>
      <input type="number" id="betAmount" value="10" min="0" max="1000">
      <button class="bet-btn" onclick="setBet(10)">+10</button>
      <button class="bet-btn" onclick="setBet(50)">+50</button>
      <button class="bet-btn" onclick="setMaxBet()">‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</button>
      
      <div id="totalBetDisplay" style="width: 100%; margin-top: 10px; font-weight: bold; color: #33ff33; font-size: 18px; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 10px;">
          ‡∏¢‡∏≠‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏£‡∏ß‡∏°: <span>0</span> ‡∏ö‡∏≤‡∏ó
      </div>
    </div>
    
    <button id="roll">‡∏´‡∏°‡∏∏‡∏ô‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤</button>

    <div id="diceArea" class="dice"></div>
    <div id="result" class="result"></div>
  </div>

<audio id="rollSound" src="https://www.soundjay.com/misc/sounds/dice-roll-1.mp3"></audio>
<audio id="winSound" src="https://www.soundjay.com/button/sounds/button-3.mp3"></audio>

<script>
// ===============================================
// üéØüéØüéØ 1. Firebase Configuration (‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì GoldoraX-Game) üéØüéØüéØ
// ===============================================
const firebaseConfig = {
    apiKey: "AIzaSyACTSU6LYObSv5gEAfKJt4Yr4LaCCAkQvw",
    authDomain: "goldorax-game.firebaseapp.com",
    databaseURL: "https://goldorax-game-default-rtdb.asia-southeast1.firebasedatabase.app", 
    projectId: "goldorax-game",
    storageBucket: "goldorax-game.firebasestorage.app",
    messagingSenderId: "601999451419",
    appId: "1:601999451419:web:f0782a8437b493eb8f5fbe",
    measurementId: "G-09PW99QK06" 
};

// ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Å‡∏ä‡∏±‡∏ô‡πÉ‡∏ô Firestore ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡∏°‡∏ô‡∏µ‡πâ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏µ‡∏Å‡∏±‡∏ö Gxlottery)
const HOO_HEY_HOW_COLLECTION = "hoo_hey_how_players";

// ===============================================
// 2. Initialize Firebase ‡πÅ‡∏•‡∏∞ Global Variables
// ===============================================
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore(); 

const ADMIN_USER = 'admin';
const ADMIN_PASS = '03774570'; 

let isLoginMode = true;
const balanceDisplay = document.getElementById('playerBalance');
const betInput = document.getElementById('betAmount'); 
let balance = 0;
let currentUsername = null; 
const minBet = 10;
const maxBetDefault = 1000;
const USER_DOMAIN = '@game.local'; 

function toggleAuthMode() {
    isLoginMode = !isLoginMode;
    document.getElementById('auth-title').textContent = isLoginMode ? '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö' : '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å';
    document.getElementById('auth-button').textContent = isLoginMode ? '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö' : '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å';
    document.getElementById('signup-fields').style.display = isLoginMode ? 'none' : 'block';
    document.getElementById('error-message').textContent = '';
    document.querySelector('.toggle-link').textContent = isLoginMode 
        ? '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà' 
        : '‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß? ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà';
}

// ===============================================
// 3. User Authentication (‡πÉ‡∏ä‡πâ Firebase Auth)
// ===============================================
async function handleAuth() {
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;
    const errorMessage = document.getElementById('error-message');
    errorMessage.textContent = ''; 

    if (!username || !password) {
        errorMessage.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô';
        return;
    }
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Admin Login (Local Check)
    if (username === ADMIN_USER && password === ADMIN_PASS) {
        adminLoginSuccess();
        return;
    }

    const email = username + USER_DOMAIN;

    try {
        if (isLoginMode) {
            // LOGIN with Firebase Auth
            await auth.signInWithEmailAndPassword(email, password);
        } else {
            // SIGN UP with Firebase Auth
            const confirmPassword = document.getElementById('confirmPassword').value;
            if (password.length < 6) {
                errorMessage.textContent = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£';
                return;
            }
            if (password !== confirmPassword) {
                errorMessage.textContent = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô';
                return;
            }
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô Firebase Auth
            const userCredential = await auth.createUserWithEmailAndPassword(email, password);
            const user = userCredential.user;

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á Document ‡πÉ‡∏ô Firestore ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Å‡∏ä‡∏±‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞)
            await db.collection(HOO_HEY_HOW_COLLECTION).doc(username).set({
                username: username,
                balance: 0,
                uid: user.uid 
            });
            alert('‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
        }
        
        // ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à) ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏î‡∏¢ auth.onAuthStateChanged
    } catch (error) {
        if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
            errorMessage.textContent = '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
        } else if (error.code === 'auth/email-already-in-use') {
            errorMessage.textContent = '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Ñ‡∏ô‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß';
        } else if (error.code === 'auth/weak-password') {
            errorMessage.textContent = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏≠‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)';
        } else if (error.code === 'auth/operation-not-allowed') {
            errorMessage.textContent = '‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Email/Password ‡πÉ‡∏ô Firebase Console';
        } else {
            console.error(error);
            errorMessage.textContent = `‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`;
        }
    }
}

// ===============================================
// 4. Game Logic Handlers
// ===============================================

async function loginSuccess(username, uid) {
    currentUsername = username;
    
    // ‡∏î‡∏∂‡∏á‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å Firestore (‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Å‡∏ä‡∏±‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞)
    const userDoc = await db.collection(HOO_HEY_HOW_COLLECTION).doc(username).get();
    
    // ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ Document ‡πÉ‡∏ô Firestore (‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏° Firestore) ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
    if (!userDoc.exists) {
        balance = 0;
        await db.collection(HOO_HEY_HOW_COLLECTION).doc(username).set({
            username: username,
            balance: balance,
            uid: uid
        });
    } else {
        balance = userDoc.data().balance;
    }
    
    document.getElementById('auth-screen').style.display = 'none';
    document.getElementById('admin-screen').style.display = 'none';
    document.getElementById('game-screen').style.display = 'block';
    
    const usernameDisplay = document.getElementById('usernameDisplay');
    usernameDisplay.textContent = `‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô ${username}:`; 
    
    balanceDisplay.textContent = balance;
    updateBetControls();
    updateTotalCostDisplay(); // ‡πÅ‡∏™‡∏î‡∏á‡∏¢‡∏≠‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏£‡∏ß‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
}

function updateBetControls() {
    let defaultBet = Math.min(balance > 0 ? 10 : 0, balance);
    betInput.value = defaultBet;
    betInput.min = balance > 0 ? minBet : 0;
    betInput.max = Math.min(balance, maxBetDefault);

    const rollButton = document.getElementById('roll');
    if (balance === 0) {
        rollButton.disabled = true;
        rollButton.textContent = '‚ö†Ô∏è ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô';
    } else {
        rollButton.disabled = false;
        rollButton.textContent = '‡∏´‡∏°‡∏∏‡∏ô‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤';
    }
}

function logout() {
    auth.signOut();
}

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ 
auth.onAuthStateChanged(user => {
    if (user) {
        const username = user.email.replace(USER_DOMAIN, '');
        loginSuccess(username, user.uid);
    } else {
        // ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ admin ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤ auth
        if (document.getElementById('admin-screen').style.display !== 'block') {
            document.getElementById('auth-screen').style.display = 'block';
            document.getElementById('game-screen').style.display = 'none';
        }
    }
});

// ===============================================
// 5. Admin Panel Logic (‡πÉ‡∏ä‡πâ Firestore)
// ===============================================
function adminLoginSuccess() {
    document.getElementById('auth-screen').style.display = 'none';
    document.getElementById('game-screen').style.display = 'none';
    document.getElementById('admin-screen').style.display = 'block';
    renderUserList(); 
}

function adminLogout() {
    window.location.reload(); 
}

async function renderUserList() {
    const userListElement = document.getElementById('user-list');
    userListElement.innerHTML = '';
    
    try {
        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å Firestore (‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Å‡∏ä‡∏±‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞)
        const snapshot = await db.collection(HOO_HEY_HOW_COLLECTION).get();
        
        let userCount = 0;
        snapshot.forEach(doc => {
            const username = doc.id;
            const user = doc.data();
            
            const listItem = document.createElement('li');
            listItem.innerHTML = `
                <span class="user-info">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: <strong>${username}</strong></span> <span class="user-balance">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô: ${user.balance} ‡∏ö‡∏≤‡∏ó</span>
                <div class="admin-controls">
                    <input type="number" id="amount-${username}" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô">
                    <button class="deposit-btn-admin" onclick="updateUserBalance('${username}', true)">+ ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</button>
                    <button class="withdraw-btn-admin" onclick="updateUserBalance('${username}', false)">- ‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</button>
                </div>
            `;
            userListElement.appendChild(listItem);
            userCount++;
        });

        if (userCount === 0) {
            userListElement.innerHTML = '<li>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</li>';
        }

    } catch (error) {
        userListElement.innerHTML = `<li>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${error.message}</li>`;
        console.error("Error loading user list:", error);
    }
}

async function updateUserBalance(username, isDeposit) {
    const amountInput = document.getElementById(`amount-${username}`);
    const amount = parseInt(amountInput.value);

    if (isNaN(amount) || amount <= 0) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!');
        return;
    }
    
    // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î reference ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Å‡∏ä‡∏±‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞
    const userRef = db.collection(HOO_HEY_HOW_COLLECTION).doc(username);

    try {
        await db.runTransaction(async (transaction) => {
            const doc = await transaction.get(userRef);
            if (!doc.exists) {
                throw "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô";
            }
            
            let currentBalance = doc.data().balance;
            let newBalance;

            if (isDeposit) {
                newBalance = currentBalance + amount;
            } else {
                if (currentBalance < amount) {
                    throw "‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠";
                }
                newBalance = currentBalance - amount;
            }
            
            transaction.update(userRef, { balance: newBalance });
            
            if (isDeposit) {
                alert(`‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ ${username}: ${amount} ‡∏ö‡∏≤‡∏ó ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏Ñ‡∏∑‡∏≠ ${newBalance} ‡∏ö‡∏≤‡∏ó`);
            } else {
                alert(`‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å ${username}: ${amount} ‡∏ö‡∏≤‡∏ó ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏Ñ‡∏∑‡∏≠ ${newBalance} ‡∏ö‡∏≤‡∏ó`);
            }
        });

        // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
        renderUserList();
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡∏´‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏≠‡∏¢‡∏π‡πà
        if (currentUsername === username) {
            balance = await getUserBalance(currentUsername); 
            balanceDisplay.textContent = balance;
            updateBetControls();
            updateTotalCostDisplay();
        }
        
        amountInput.value = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô input

    } catch (error) {
        if (error === "‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠") {
            alert(`‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô ${username} ‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô ${amount} ‡∏ö‡∏≤‡∏ó`);
        } else {
            alert(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error}`);
            console.error("Transaction failed: ", error);
        }
    }
}

async function getUserBalance(username) {
    const doc = await db.collection(HOO_HEY_HOW_COLLECTION).doc(username).get();
    return doc.exists ? doc.data().balance : 0;
}


// ===============================================
// 6. Game Logic Handlers
// ===============================================

const animals = ['‡∏ô‡πâ‡∏≥‡πÄ‡∏ï‡πâ‡∏≤','‡∏õ‡∏π','‡∏õ‡∏•‡∏≤','‡πÄ‡∏™‡∏∑‡∏≠','‡πÑ‡∏Å‡πà','‡∏Å‡∏∏‡πâ‡∏á'];
const emojis = ['üçê','ü¶Ä','üêü','üêØ','üêî','ü¶ê'];
const animalValues = { '‡∏ô‡πâ‡∏≥‡πÄ‡∏ï‡πâ‡∏≤': 1, '‡∏õ‡∏π': 2, '‡∏õ‡∏•‡∏≤': 3, '‡πÄ‡∏™‡∏∑‡∏≠': 4, '‡πÑ‡∏Å‡πà': 5, '‡∏Å‡∏∏‡πâ‡∏á': 6 };

const activeBets = new Map(); 

const diceArea = document.getElementById('diceArea');
const result = document.getElementById('result');
const rollSound = document.getElementById('rollSound');
const winSound = document.getElementById('winSound');


// **** ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢ ****
function updateTotalCostDisplay() {
    const amountPerBet = parseInt(betInput.value) || 0;
    const totalCost = amountPerBet * activeBets.size;
    document.querySelector('#totalBetDisplay span').textContent = totalCost.toLocaleString();
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏¢‡∏≠‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏£‡∏ß‡∏°‡πÄ‡∏Å‡∏¥‡∏ô‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    const rollButton = document.getElementById('roll');
    if (totalCost > balance && balance > 0) {
        rollButton.disabled = true;
        rollButton.textContent = '‚ùå ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏£‡∏ß‡∏°‡πÄ‡∏Å‡∏¥‡∏ô‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô!';
    } else if (balance > 0) {
        rollButton.disabled = false;
        rollButton.textContent = '‡∏´‡∏°‡∏∏‡∏ô‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤';
    }
}
// **********************************************

function setBet(amount) {
    let currentBet = parseInt(betInput.value) || 0;
    let newBet = currentBet + amount;

    if (newBet < minBet && balance > 0) newBet = minBet; 
    if (newBet > balance || newBet > maxBetDefault) {
      newBet = Math.min(balance, maxBetDefault);
    }
    if (balance === 0) newBet = 0;

    betInput.value = newBet;
    updateTotalCostDisplay(); // <--- ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô
}

function setMaxBet() {
    let max = Math.min(balance, maxBetDefault);
    betInput.value = max;
    updateTotalCostDisplay(); // <--- ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô
}

betInput.addEventListener('input', updateTotalCostDisplay); // ‡∏î‡∏±‡∏Å‡∏à‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç

const bettingButtons = document.querySelectorAll('[data-bet-type]');
bettingButtons.forEach(btn => {
    btn.addEventListener('click', () => {
        const type = btn.dataset.betType;
        const value = btn.dataset.betValue;
        const key = `${type}-${value}`;

        if (activeBets.has(key)) {
            activeBets.delete(key);
            btn.classList.remove('selected');
        } else {
            // ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö High/Low/Triple: ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà 1 ‡∏ï‡∏±‡∏ß‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏µ‡πâ
            if (type !== 'single' && (activeBets.has('high_low-High') || activeBets.has('high_low-Low') || activeBets.has('triple_any-Any'))) {
                // ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å High/Low/Triple ‡∏ï‡∏±‡∏ß‡∏≠‡∏∑‡πà‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô
                let conflictingKey = Array.from(activeBets.keys()).find(k => k.startsWith('high_low') || k.startsWith('triple_any'));
                if (conflictingKey) {
                    activeBets.get(conflictingKey).classList.remove('selected');
                    activeBets.delete(conflictingKey);
                }
            }
            
            activeBets.set(key, btn);
            btn.classList.add('selected');
        }
        
        updateTotalCostDisplay(); // <--- ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å/‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
    });
});


// ===============================================
// 7. ‡πÇ‡∏Ñ‡πâ‡∏î Roll Dice ‡∏û‡∏£‡πâ‡∏≠‡∏° Transaction ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
// ===============================================

document.getElementById('roll').addEventListener('click', async () => {
    const currentBetAmount = parseInt(betInput.value); 

    if (activeBets.size === 0) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏≠‡∏¢‡πà‡∏≤‡∏á!'); return; }
    
    const totalBetCost = currentBetAmount * activeBets.size;
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏° Transaction
    if (totalBetCost > balance) { 
        alert(`‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${totalBetCost} ‡∏ö‡∏≤‡∏ó!`); 
        updateBetControls(); 
        updateTotalCostDisplay();
        return; 
    }

    // ************ ‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° UI ‡∏Å‡πà‡∏≠‡∏ô Transaction ************
    // ‡∏´‡∏±‡∏Å‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ balance ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ (UI) ‡∏Å‡πà‡∏≠‡∏ô
    balance -= totalBetCost;
    balanceDisplay.textContent = balance;
    diceArea.textContent = '‡∏´‡∏°‡∏∏‡∏ô...';
    result.textContent = '';
    rollSound.currentTime = 0;
    rollSound.play();
    document.getElementById('roll').disabled = true; // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏ã‡πâ‡∏≥

    try {
        // ************ 1. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏´‡∏±‡∏Å‡∏•‡∏á‡πÉ‡∏ô Firestore ‡∏î‡πâ‡∏ß‡∏¢ Transaction ************
        await db.runTransaction(async (transaction) => {
            const userRef = db.collection(HOO_HEY_HOW_COLLECTION).doc(currentUsername);
            const userDoc = await transaction.get(userRef);

            if (!userDoc.exists) {
                throw new Error("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
            }
            
            let dbBalance = userDoc.data().balance;
            let newDbBalance = dbBalance - totalBetCost;

            if (newDbBalance < 0) {
                // ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏à‡∏≤‡∏Å Race Condition ‡πÉ‡∏´‡πâ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                throw new Error("‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏û‡∏≠ (Race Condition)");
            }

            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏´‡∏±‡∏Å‡∏•‡∏á‡πÉ‡∏ô DB
            transaction.update(userRef, { balance: newDbBalance });
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÉ‡∏ô JS ‡∏î‡πâ‡∏ß‡∏¢‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏´‡∏±‡∏Å‡∏à‡∏≤‡∏Å DB ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏ï‡πà‡∏≠
            balance = newDbBalance;
        });

        // ************ 2. ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏∏‡∏ô‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏• ************
        setTimeout(async () => { 
            const diceResults = []; 
            const diceValues = []; 
            for (let i = 0; i < 3; i++) {
                const randomIndex = Math.floor(Math.random() * animals.length);
                const animalName = animals[randomIndex];
                diceResults.push(animalName);
                diceValues.push(animalValues[animalName]);
            }
            
            diceArea.innerHTML = diceResults.map(name => emojis[animals.indexOf(name)]).join(' ');

            const sum = diceValues.reduce((a, b) => a + b, 0);
            const counts = diceResults.reduce((acc, name) => {
                acc[name] = (acc[name] || 0) + 1;
                return acc;
            }, {});
            
            const isTriple = Object.values(counts).some(count => count === 3);
            const tripleAnimal = isTriple ? diceResults[0] : null;
            const isHigh = sum >= 11 && sum <= 17;
            const isLow = sum >= 4 && sum <= 10;
            
            let totalWinnings = 0;
            let winDetails = [];
            let didWin = false;

            activeBets.forEach((element, key) => {
                const [type, value] = key.split('-');
                let profit = 0;
                let resultMessage = '';

                switch(type) {
                    case 'single':
                        const hitCount = counts[value] || 0;
                        if (hitCount > 0) {
                            profit = currentBetAmount * hitCount; 
                            resultMessage = `‡∏ä‡∏ô‡∏∞ ‡πÅ‡∏ó‡∏á‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß ${value} ‡∏≠‡∏≠‡∏Å ${hitCount} ‡∏ï‡∏±‡∏ß (‡∏Å‡∏≥‡πÑ‡∏£ ${profit} ‡∏ö‡∏≤‡∏ó)`;
                        }
                        break;

                    case 'high_low':
                        const betIsHigh = value === 'High';
                        
                        if (isTriple) {
                            resultMessage = `‡πÅ‡∏û‡πâ ‡∏ï‡∏≠‡∏á‡∏≠‡∏≠‡∏Å (‡∏™‡∏π‡∏á/‡∏ï‡πà‡∏≥ ‡πÅ‡∏û‡πâ‡∏ó‡∏∏‡∏Å‡∏Å‡∏£‡∏ì‡∏µ)`;
                        } else if ((betIsHigh && isHigh) || (!betIsHigh && isLow)) {
                            profit = currentBetAmount * 1;
                            resultMessage = `‡∏ä‡∏ô‡∏∞ ‡πÅ‡∏ó‡∏á ${value} (‡πÅ‡∏ï‡πâ‡∏°‡∏£‡∏ß‡∏° ${sum}) (‡∏Å‡∏≥‡πÑ‡∏£ ${profit} ‡∏ö‡∏≤‡∏ó)`;
                        }
                        break;
                    
                    case 'triple_any':
                        if (isTriple) {
                            profit = currentBetAmount * 7; 
                            resultMessage = `‡∏ä‡∏ô‡∏∞ ‡∏ï‡∏≠‡∏á ${tripleAnimal} (‡∏Å‡∏≥‡πÑ‡∏£ ${profit} ‡∏ö‡∏≤‡∏ó)`;
                        }
                        break;
                }
                
                if (profit > 0) {
                    totalWinnings += profit;
                    didWin = true;
                    winDetails.push(resultMessage);
                } else if (resultMessage) {
                    winDetails.push(resultMessage);
                }
            });
            
            const totalPayout = totalBetCost + totalWinnings; 
            balance += totalWinnings; // ‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô
            
            if (didWin) {
                result.textContent = `üéâ ‡∏ä‡∏ô‡∏∞! ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${totalPayout} ‡∏ö‡∏≤‡∏ó (‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ ${totalWinnings} ‡∏ö‡∏≤‡∏ó)\n‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ${winDetails.join(' | ')}`;
                winSound.currentTime = 0;
                winSound.play();
            } else {
                result.textContent = `‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏à! ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡∏ô‡∏∞ üò¢ (‡πÄ‡∏™‡∏µ‡∏¢ ${totalBetCost} ‡∏ö‡∏≤‡∏ó)`;
            }

            balanceDisplay.textContent = balance;
            
            activeBets.forEach(element => element.classList.remove('selected'));
            activeBets.clear();
            
            // ************ 3. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏•‡∏á‡πÉ‡∏ô Firestore ‡∏î‡πâ‡∏ß‡∏¢ Transaction ************
            await db.runTransaction(async (transaction) => {
                const userRef = db.collection(HOO_HEY_HOW_COLLECTION).doc(currentUsername);
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏•‡∏á‡πÉ‡∏ô DB
                transaction.update(userRef, { balance: balance });
            });
            
            updateBetControls();
            updateTotalCostDisplay(); // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô 0
            document.getElementById('roll').disabled = false; // ‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°

        }, 900); // end setTimeout

    } catch (error) {
        // ‡∏´‡∏≤‡∏Å Transaction ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß (‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡∏±‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ, DB Error)
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•! ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏´‡∏±‡∏Å/‡πÄ‡∏û‡∏¥‡πà‡∏° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
        
        // ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏∂‡∏á‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å DB ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        const latestBalance = await getUserBalance(currentUsername);
        balance = latestBalance; 
        
        balanceDisplay.textContent = balance;
        console.error("Game Roll Transaction Failed: ", error);
        document.getElementById('roll').disabled = false;
        updateBetControls();
        updateTotalCostDisplay(); // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô 0
        result.textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠!';
    }
});
</script>
</body>
</html>
